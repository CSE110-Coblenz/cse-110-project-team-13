name: CI Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Checkout code
    - name: Checkout code
      uses: actions/checkout@v3 # pre-built GitHub Action provided by GitHub 
                                # It's like running:
                                # git clone https://github.com/your-username/your-repo.git
                                # cd your-repo

    # 2. Setup Node.js
    - name: Setup Node.js
      uses: actions/setup-node@v3
            # Download and install Node.js 18
            # Set up npm cache for faster installs
            # Configure the environment
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: 'historical-map-game/package-lock.json'
        
    # 3. Install dependencies
    - name: Install dependencies
      run: |
        cd historical-map-game
        npm install
      
    # 4. Run TypeScript compilation check
    - name: TypeScript Compilation Check
      run: |
        cd historical-map-game
        npx tsc --noEmit # tsc to skip the emission of any output files. Turns the compiler into a type-checking-only tool
      
    # 5. Run basic tests
    - name: Run Basic Checks
      run: |
        echo "üß™ Running basic checks..."
        # Check if key files exist
        test -f historical-map-game/index.html && echo "‚úÖ index.html exists" || echo "‚ùå index.html missing"
        test -f historical-map-game/css/styles.css && echo "‚úÖ styles.css exists" || echo "‚ùå styles.css missing"
        test -f historical-map-game/scripts/main.ts && echo "‚úÖ main.ts exists" || echo "‚ùå main.ts missing"
    
    # 6. Run game logic tests
    - name: Run Game Logic Tests
      run: |
        cd historical-map-game
        npm test
        
    # 7. Build the project
    - name: Build Project
      run: |
        cd historical-map-game
        npm run build